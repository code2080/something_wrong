# This config is equivalent to both the '.circleci/extended/orb-free.yml' and the base '.circleci/config.yml'
version: 2.1

jobs:
  test:
      docker:
      # Primary container
       - image: circleci/node:15.14.0
      steps:
        - checkout
        - add_ssh_keys:
            fingerprints: 
              - "256 SHA256:B205eHsllnf9SPDzqvw351xfJQRE/N68NH+wkkKy1n4 info@timeedit.com (ED25519)"
        - run:
            name: Install Submodules
            command: git submodule sync && git submodule update --init
        - restore_cache:
            keys:
              - dependencies-{{ .Branch }}-{{ checksum "yarn.lock" }}
              - dependencies-{{ .Branch }}-
              - dependencies-master-
        - run:
            name: Install Dependencies
            command: yarn
        - save_cache:
            key: dependencies-{{ .Branch }}-{{ checksum "yarn.lock" }}
            paths:
              - ./node_modules
        - run:
            name: Lint
            command: |
              mkdir -p ~/reports
              yarn lint  --output-file ~/reports/eslint.xml
              yarn ts:lint
        - run:
              name: Prettier
              command: yarn prettier
        - run:
              name: Test
              command: yarn test
        - store_test_results:
            path: ~/reports
        - store_artifacts:
            path: ~/reports

workflows:
  version: 2
  test:
    jobs:
       - test
 
   